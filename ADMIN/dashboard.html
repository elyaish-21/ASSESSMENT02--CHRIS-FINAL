<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin Dashboard</title>
  <link rel="stylesheet" href="style.css" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
  
  <!--Nav Bar-->
  <div class="dashboard">
    <aside class="sidebar">
      <h3>ADMIN <br />DASHBOARD <br /> <small>Civil Registry Information System</small></h3>
      <ul>
        <li class="active"><a href="#" onclick="showSection('overview')"><i class="fa fa-bar-chart" style="font-size:24px; transform: translateX(1.5rem);"></i>Overview</a></li>
        <li><a href="#" onclick="showSection('birth')"><i class="fas fa-baby mr-3" style="font-size:24px; transform: translateX(1.5rem);" ></i> Birth Information</a></li>
        <li><a href="#" onclick="showSection('marriage')"><i class="fas fa-solid fa-ring mr-3" style="font-size:24px; transform: translateX(1.5rem);" ></i> Marriage Information</a></li>
        <li><a href="#" onclick="showSection('death')"><i class="fas fa-cross mr-3" style="font-size:24px; transform: translateX(1.5rem);" ></i> Death Information</a></li>
      </ul>
      <button class="logout-btn" onclick="location.href='login.html'"><i class="fas fa-sign-out-alt mr-3" style="font-size:24px; transform: translateX(-2rem);" ></i>Log-out</button>
    </aside>


    <main class="main-content">
      <div id="overview" class="section">
        <div class="header">
          <h2>Overview</h2>
        </div>

        
        <div class="container">
          <div class="BR">
            <h3>Birth Records</h3>
            <div class="count">0</div>
            <div class="percentage">+20% this month</div>
            <div class="icon-container">
            <i class="fas fa-baby"></i>
            </div>
          </div>

          <div class="MR">
            <h3>Marriage Records</h3>
            <div class="count">0</div>
            <div class="percentage">+10% this month</div>
            <div class="icon-container">
            <i class="fas fa-solid fa-ring" ></i>
            </div>
          </div>

          <div class="DR">
            <h3>Death Records</h3>
            <div class="count">0</div>
            <div class="percentage">+12% this month</div>
            <div class="icon-container">
            <i class="fas fa-cross"></i>
            </div>
          </div>
        </div>
        
        <div class="graph-container">
          <canvas id="recordsChart"></canvas>
        </div> 
        

        <div class="container2">

            <div class="activity-container">
              <h3>Recent Activities</h3>
                  <div class="activity">
                        <div class="icon blue"><i class="fa-solid fa-plus"></i></div>
                           <div class="info">
                              <strong>New birth record added</strong>
                             
                            </div>
                  </div>

                  <div class="activity">
                    <div class="icon yellow"><i class="fa-solid fa-pen"></i></div>
                      <div class="info">
                        <strong>Marriage record updated</strong>
                        
                      </div>
                  </div>

                  <div class="activity">
                      <div class="icon red"><i class="fa-solid fa-trash"></i></div>
                      <div class="info">
                        <strong>Death record deleted</strong>
                        
                      </div>
                  </div>
          </div>

                  <div class="pieChart">
                    <h3>Type Distribution</h3>
                    <div class="pie-chart">
                      <canvas id="requestTypeChart"></canvas>
                    </div>
                  </div>

      </div>
     </div>

      
      <div id="birth" class="section" style="display: none;">
        <div class="header">
          <h2>Birth Informations</h2>

            <div class="controls">              
              <div class="search-bar">
                <i class="fas fa-search"></i>
                <input type="text" id="searchInputBirth" placeholder="Search Birth Records..." oninput="applySearch('BirthTable', 'searchInputBirth')" />
              </div>

             <!-- Add inside the birth section after the header -->
             <div class="filter-header" onclick="toggleFilterPanel('birth-filter')"><i class="fas fa-filter mr-2"></i> Filter</div>

             <div class="filter-panel" id="birth-filter">
                    <div class="filter-group">
                      <label for="birth-requestType">Request Type:</label>
                      <select id="birth-requestType">
                        <option value="">All</option>
                        <option value="Schedule an Appointment">Schedule an Appointment</option>
                        <option value="Birth Certificate Registration">Birth Certificate Registration</option>
                        <option value="Request for Correction of Birth Certificate">Request for Correction of Birth Certificate</option>
                        <option value="Request for Birth Certificate with CTC (Home Delivery)">Request for Birth Certificate with CTC (Home Delivery)</option>
                        <option value="Delayed Registration of Birth (Beyond 30 Days)">Delayed Registration of Birth (Beyond 30 Days)</option>
                      </select>
                    </div>
                    <div class=".filter-group">
                       <label for="nameFilter">Name:</label>
                       <input type="text" id="birth-nameFilter" placeholder="Enter name" />
               
                       <label for="registryFilter">REG NO:</label>
                       <input type="text" id="birth-registryFilter" placeholder="REG-XXXXXXXX-XXXXX" />
                    </div>
                    <div class=".date-range">
                       <label for="startDate">From:</label>
                       <input type="date" id="birth-startDate">
           
                       <label for="endDate">To:</label>
                       <input type="date" id="birth-endDate">
                    </div>
                    <div class=".button-group">
                      <button class="applybtn" onclick="applyAdvancedFilter('birth')">Apply</button>
                      <button class="resetbtn" onclick="resetAdvancedFilter('birth')">Reset</button>
                    </div>
               </div>
            </div>
        </div>
        
        <table id="BirthTable">
            <thead>
              <tr>
                <th>Name</th>
                <th>Type of Request</th>
                <th>Reg. No.</th>
                <th>Date Registered</th>
                <th>Status</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              <!-- Rows will be dynamically added here -->
            </tbody>
          </table>
      </div>

            <div id="death" class="section">
        <div class="header">
          <h2>Death Informations</h2>
          <div class="controls">
            <div class="search-bar">
              <i class="fas fa-search"></i>
              <input type="text" id="searchInputDeath" placeholder="Search Death Records..." oninput="applySearch('DeathTable', 'searchInputDeath')" />
            </div>
            <div class="filter-header" onclick="toggleFilterPanel('death-filter')"><i class="fas fa-filter mr-2"></i> Filter</div>

            <div class="filter-panel" id="death-filter">
              <div class="filter-group">
                <label for="death-requestType">Request Type:</label>
                <select id="death-requestType">
                  <option value="">All</option>
                  <option value="Schedule an Appointment">Schedule an Appointment</option>
                  <option value="Death Certificate Registration">Death Certificate Registration</option>
                  <option value="Request for Correction of Death Certificate">Request for Correction of Death Certificate</option>
                  <option value="Delayed Registration of Death">Delayed Registration of Death</option>
                  <option value="Request for Death Certificate (Home Delivery)">Request for Death Certificate (Home Delivery)</option>
                  <option value="Burial Permit Application">Burial Permit Application</option>
                  <option value="Cremation Permit Application">Cremation Permit Application</option>
                </select>
              </div>
              <div class=".filter-group">
                <label for="nameFilter">Name:</label>
                <input type="text" id="death-nameFilter" placeholder="Enter name" />
                <label for="registryFilter">REG NO:</label>
                <input type="text" id="death-registryFilter" placeholder="REG-XXXXXXXX-XXXXX" />
              </div>
              <div class=".date-range">
                <label for="startDate">From:</label>
                <input type="date" id="death-startDate">
                <label for="endDate">To:</label>
                <input type="date" id="death-endDate">
              </div>
              <div class=".button-group">
                <button class="applybtn" onclick="applyAdvancedFilter('death')">Apply</button>
                <button class="resetbtn" onclick="resetAdvancedFilter('death')">Reset</button>
              </div>
            </div>
          </div>
        </div>
        <table id="DeathTable">
          <thead>
            <tr>
              <th>Name</th>
              <th>Type of Request</th>
              <th>Reg. No.</th>
              <th>Date Registered</th>
              <th>Status</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            <!-- Rows will be dynamically added here -->
          </tbody>
        </table>
      </div>

      <div id="marriage" class="section" style="display: none;">
        <div class="header">
          <h2>Marriage Informations</h2>

            <div class="controls">

              <div class="search-bar">
                <i class="fas fa-search"></i>
                <input type="text" id="searchInputMarriage" placeholder="Search Marriage Records..." oninput="applySearch('MarriageTable', 'searchInputMarriage')" />
              </div>

              <!-- Add inside the birth section after the header -->
            <div class="filter-header" onclick="toggleFilterPanel('marriage-filter')"><i class="fas fa-filter mr-2"></i> Filter</div>
            <div class="filter-panel" id="marriage-filter">
              <div class="filter-group">
                <label for="marriage-requestType">Request Type:</label>
                <select id="marriage-requestType">
                  <option value="">All</option>
                  <option value="Schedule an Appointment">Schedule an Appointment</option>
                  <option value="Marriage Certificate Registration">Marriage Certificate Registration</option>
                  <option value="Request for Correction of Marriage Certificate">Request for Correction of Marriage Certificate</option>
                  <option value="Delayed Registration of Marriage">Delayed Registration of Marriage</option>
                  <option value="Marriage License Registration">Marriage License Registration</option>
                  <option value="Request for Marriage Certificate (Home Delivery)">Request for Marriage Certificate (Home Delivery)</option>
                </select>
              </div>
              <div class=".filter-group">
                <label for="nameFilter">Name:</label>
                <input type="text" id="marriage-nameFilter" placeholder="Enter name" />
                <label for="registryFilter">REG NO:</label>
                <input type="text" id="marriage-registryFilter" placeholder="REG-XXXXXXXX-XXXXX" />
              </div>
              <div class=".date-range">
                <label for="startDate">From:</label>
                <input type="date" id="marriage-startDate">
                <label for="endDate">To:</label>
                <input type="date" id="marriage-endDate">
              </div>
              <div class=".button-group">
                <button class="applybtn" onclick="applyAdvancedFilter('marriage')">Apply</button>
                <button class="resetbtn" onclick="resetAdvancedFilter('marriage')">Reset</button>
              </div>
            </div>
          </div>

        </div>
          <table id="MarriageTable">
            <thead>
              <tr>
                <th>Name</th>
                <th>Type of Request</th>
                <th>Reg. No.</th>
                <th>Date Registered</th>
                <th>Status</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              <!-- Rows will be dynamically added here -->
            </tbody>
          </table>
        </div>
      </div>


    </main>
  </div>

  <div id="editOverlay" class="overlay" style="display: none;">
    <div class="overlay-content">
      <h2>Edit Record</h2>
      <form id="editForm">
        <label for="editName">Name:</label>
        <input type="text" id="editName" name="editName" />
  
        <label for="editType">Type of Request:</label>
        <input type="text" id="editType" name="editType" />
  
        <label for="editRegNo">Registration Number:</label>
        <input type="text" id="editRegNo" name="editRegNo" />
  
        <label for="editDateRegistered">Date Registered:</label>
        <input type="date" id="editDateRegistered" name="editDateRegistered" />
  
        <label for="editStatus">Status:</label>
        <select id="editStatus" name="editStatus">
          <option value="Received">Received</option>
          <option value="Processing">Processing</option>
          <option value="For Signature">For Signature</option>
          <option value="Ready for Release">Ready for Release</option>
        </select>
  
        <div class="button-group">
          <button type="button" onclick="saveEdit()">Save</button>
          <button type="button" onclick="closeOverlay()">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <div id="editOverlay" class="overlay" style="display: none;">
    <div class="overlay-content">
      <h2>Edit Record</h2>
      <form id="editForm">
        <label for="editName">Name:</label>
        <input type="text" id="editName" name="editName" />
  
        <label for="editType">Type of Request:</label>
        <input type="text" id="editType" name="editType" />
  
        <label for="editRegNo">Registration Number:</label>
        <input type="text" id="editRegNo" name="editRegNo" />
  
        <label for="editDateRegistered">Date Registered:</label>
        <input type="date" id="editDateRegistered" name="editDateRegistered" />
  
        <label for="editStatus">Status:</label>
        <select id="editStatus" name="editStatus">
          <option value="Received">Received</option>
          <option value="Processing">Processing</option>
          <option value="For Signature">For Signature</option>
          <option value="Ready for Release">Ready for Release</option>
        </select>
  
        <div class="button-group">
          <button type="button" onclick="saveEdit()">Save</button>
          <button type="button" onclick="closeOverlay()">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <div class="gtranslate_wrapper"></div>
  <script>
    window.gtranslateSettings = {
      "default_language":"..",
      "wrapper_selector":".gtranslate_wrapper",
      "switcher_horizontal_position":"right",
      "switcher_vertical_position":"bottom",
      "flag_style":"3d"
    }
  </script>
  <script src="https://cdn.gtranslate.net/widgets/latest/float.js" defer></script>

  <script>
    
function countRecords() {
  const birthRecords = JSON.parse(localStorage.getItem("BirthRecords")) || [];
  const marriageRecords = JSON.parse(localStorage.getItem("MarriageRecords")) || [];
  const deathRecords = JSON.parse(localStorage.getItem("DeathRecords")) || [];

  console.log("Birth Records:", birthRecords);
  console.log("Marriage Records:", marriageRecords);
  console.log("Death Records:", deathRecords);

  const birthCount = birthRecords.length;
  const marriageCount = marriageRecords.length;
  const deathCount = deathRecords.length;

  console.log(`Birth Records Count: ${birthCount}`);
  console.log(`Marriage Records Count: ${marriageCount}`);
  console.log(`Death Records Count: ${deathCount}`);

  // Update the dashboard counts dynamically
  document.querySelector(".BR .count").innerText = birthCount;
  document.querySelector(".MR .count").innerText = marriageCount;
  document.querySelector(".DR .count").innerText = deathCount;
}

function deleteRecord(type, regNo) {
  // Retrieve the records from localStorage
  const records = JSON.parse(localStorage.getItem(type)) || [];

  // Filter out the record with the matching regNo
  const updatedRecords = records.filter(record => record.regNo !== regNo);

  // Save the updated records back to localStorage
  localStorage.setItem(type, JSON.stringify(updatedRecords));

  // Reload the dashboard records and counts
  loadDashboardRecords();
  countRecords();

  // Re-render the graph to reflect the updated data
  renderGraph();
}
  // Filter functionality
function toggleFilterPanel(filterId) {
  const filterpanel = document.getElementById(filterId);
  filterpanel.classList.toggle("active");
}


//EDIT AND DELETE FUNCTIONALITY
  function toggleMenu(ellipsis) {
    const menu = ellipsis.nextElementSibling;

    // Close all other menus
    document.querySelectorAll('.action-menu').forEach(m => {
      if (m !== menu) m.style.display = 'none';
    });

    // Toggle clicked menu
    menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
  }

  document.addEventListener('click', function (e) {
    if (!e.target.closest('.actions')) {
      document.querySelectorAll('.action-menu').forEach(menu => {
        menu.style.display = 'none';
      });
    }
  });

  function showSection(sectionId) {
    const sections = document.querySelectorAll(".section");
    sections.forEach(section => section.style.display = "none");
    document.getElementById(sectionId).style.display = "block";

    const menuItems = document.querySelectorAll(".sidebar li");
    menuItems.forEach(item => item.classList.remove("active"));

    const link = [...menuItems].find(item =>
      item.querySelector("a").onclick?.toString().includes(sectionId)
    );
    if (link) link.classList.add("active");
  } 

  function applyFilterOverview() {
    const filterValue = document.getElementById("filterTypeOverview").value;
    const searchText = document.getElementById("searchInputOverview").value.toLowerCase();
    const rows = document.querySelectorAll("#overviewTableBody tr");

    rows.forEach(row => {
      const rowType = row.getAttribute("data-type");
      const rowText = row.innerText.toLowerCase();

      const matchesType = !filterValue || rowType === filterValue;
      const matchesSearch = !searchText || rowText.includes(searchText);

      row.style.display = matchesType && matchesSearch ? "" : "none";
    });

    showSection('overview');

    const menuItems = document.querySelectorAll(".sidebar li");
    menuItems.forEach(item => item.classList.remove("active"));
    const overviewMenu = [...menuItems].find(item =>
      item.querySelector("a").onclick?.toString().includes('overview')
    );
    if (overviewMenu) overviewMenu.classList.add("active");
  }

  function applyAdvancedFilter(section) {
  const tableId = section === "birth" ? "BirthTable" : section === "marriage" ? "MarriageTable" : "DeathTable";
  const recordsKey = section === "birth" ? "BirthRecords" : section === "marriage" ? "MarriageRecords" : "DeathRecords";

  const records = JSON.parse(localStorage.getItem(recordsKey)) || [];
  const tbody = document.querySelector(`#${tableId} tbody`);

  // Get filter values specific to the section
  const requestType = document.getElementById(`${section}-requestType`).value.toLowerCase();
  const nameFilter = document.getElementById(`${section}-nameFilter`).value.toLowerCase();
  const registryFilter = document.getElementById(`${section}-registryFilter`).value.toLowerCase();
  const startDate = document.getElementById(`${section}-startDate`).value;
  const endDate = document.getElementById(`${section}-endDate`).value;

  // Clear existing rows
  tbody.innerHTML = "";

  // Filter records based on input values
  const filteredRecords = records.filter(record => {
    const matchesRequestType = !requestType || record.type.toLowerCase() === requestType;
    const matchesName = !nameFilter || record.name.toLowerCase().includes(nameFilter);
    const matchesRegistry = !registryFilter || record.regNo.toLowerCase().includes(registryFilter);
    const matchesStartDate = !startDate || new Date(record.dateRegistered) >= new Date(startDate);
    const matchesEndDate = !endDate || new Date(record.dateRegistered) <= new Date(endDate);

    return matchesRequestType && matchesName && matchesRegistry && matchesStartDate && matchesEndDate;
  });

  // Render filtered records
  filteredRecords.forEach(record => {
    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${record.name}</td>
      <td>${record.type}</td>
      <td>${record.regNo}</td>
      <td>${record.dateRegistered}</td>
      <td>
        <div class="progress-bar-container">
          <div class="progress-bar" style="width: ${getProgressPercentage(record.status)}%; background-color: ${getStatusColor(record.status)};"></div>
          <span style="color: ${getStatusColor(record.status)};">${record.status}</span>
        </div>
      </td>
      <td class="actions">
        <span class="ellipsis" onclick="toggleMenu(this)"><i class="fas fa-ellipsis-v"></i></span>
        <div class="action-menu">
          <button onclick="editRow('${recordsKey}', '${record.regNo}')"><i class="fas fa-edit mr-2"></i> Edit</button>
          <button onclick="deleteRecord('${recordsKey}', '${record.regNo}')"><i class="fas fa-trash mr-2"></i> Delete</button>
        </div>
      </td>
    `;
    tbody.appendChild(row);
  });
}

function resetAdvancedFilter(section) {
  const tableId = section === "birth" ? "BirthTable" : section === "marriage" ? "MarriageTable" : "DeathTable";
  const recordsKey = section === "birth" ? "BirthRecords" : section === "marriage" ? "MarriageRecords" : "DeathRecords";

  // Clear filter inputs specific to the section
  document.getElementById(`${section}-requestType`).value = "";
  document.getElementById(`${section}-nameFilter`).value = "";
  document.getElementById(`${section}-registryFilter`).value = "";
  document.getElementById(`${section}-startDate`).value = "";
  document.getElementById(`${section}-endDate`).value = "";

  // Reload all records
  const records = JSON.parse(localStorage.getItem(recordsKey)) || [];
  const tbody = document.querySelector(`#${tableId} tbody`);

  tbody.innerHTML = "";
  records.forEach(record => {
    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${record.name}</td>
      <td>${record.type}</td>
      <td>${record.regNo}</td>
      <td>${record.dateRegistered}</td>
      <td>
        <div class="progress-bar-container">
          <div class="progress-bar" style="width: ${getProgressPercentage(record.status)}%; background-color: ${getStatusColor(record.status)};"></div>
          <span style="color: ${getStatusColor(record.status)};">${record.status}</span>
        </div>
      </td>
      <td class="actions">
        <span class="ellipsis" onclick="toggleMenu(this)"><i class="fas fa-ellipsis-v"></i></span>
        <div class="action-menu">
          <button onclick="editRow('${recordsKey}', '${record.regNo}')"><i class="fas fa-edit mr-2"></i> Edit</button>
          <button onclick="deleteRecord('${recordsKey}', '${record.regNo}')"><i class="fas fa-trash mr-2"></i> Delete</button>
        </div>
      </td>
    `;
    tbody.appendChild(row);
  });
}


  let currentEditType = null;
let currentEditRegNo = null;

function editRow(type, regNo) {
  const records = JSON.parse(localStorage.getItem(type)) || [];
  console.log("Records:", records); // Debugging
  console.log("Passed regNo:", regNo); // Debugging

  const record = records.find(r => r.regNo === regNo);

  if (!record) {
    alert("Record not found!");
    return;
  }

  // Store the current type and regNo for saving later
  currentEditType = type;
  currentEditRegNo = regNo;

  // Populate the overlay form with the record's data
  document.getElementById("editName").value = record.name;
  document.getElementById("editType").value = record.type;
  document.getElementById("editRegNo").value = record.regNo;
  document.getElementById("editDateRegistered").value = record.dateRegistered;
  document.getElementById("editStatus").value = record.status;

  // Show the overlay
  document.getElementById("editOverlay").style.display = "flex";
}

function saveEdit() {
  const records = JSON.parse(localStorage.getItem(currentEditType)) || [];
  const record = records.find(r => r.regNo === currentEditRegNo);

  if (!record) {
    alert("Record not found!");
    return;
  }

  const statusOrder = ["Received", "Processing", "For Signature", "Ready for Release"]; // Correct order of statuses
  const currentStatusIndex = statusOrder.indexOf(record.status); // Get the current status index

  const newStatus = document.getElementById("editStatus").value; // Get the new status from the overlay
  const newStatusIndex = statusOrder.indexOf(newStatus); // Get the new status index

  // Validate the status transition
  if (newStatusIndex === currentStatusIndex + 1 || newStatusIndex === currentStatusIndex) {
    // Update the record with the form data
    record.name = document.getElementById("editName").value;
    record.type = document.getElementById("editType").value;
    record.regNo = document.getElementById("editRegNo").value;
    record.dateRegistered = document.getElementById("editDateRegistered").value;
    record.status = newStatus;

    // Save the updated records back to localStorage
    localStorage.setItem(currentEditType, JSON.stringify(records));

    // Reload the dashboard records
    loadDashboardRecords();

    // Update the graph to reflect the changes
    renderGraph();

    // Close the overlay
    closeOverlay();
  } else {
    alert("Invalid status transition! You can only move to the next status in the sequence or keep the current status.");
  }
}

function closeOverlay() {
  document.getElementById("editOverlay").style.display = "none";
}

  function deleteRow(id) {
    if (confirm("Are you sure you want to delete row ID: " + id + "?")) {
      alert("Deleted row ID: " + id);
    }
  }

  window.onload = function () {
    showSection('overview');
  };
</script>
<script>
function loadDashboardRecords() {
  const Birthrecords = JSON.parse(localStorage.getItem("BirthRecords")) || [];
  const Marriagerecords = JSON.parse(localStorage.getItem("MarriageRecords")) || [];
  const Deathrecords = JSON.parse(localStorage.getItem("DeathRecords")) || [];

  const Birthtbody = document.querySelector("#BirthTable tbody");
  const Marriagetbody = document.querySelector("#MarriageTable tbody");
  const Deathtbody = document.querySelector("#DeathTable tbody");

  // Clear existing rows for Birth records
  Birthtbody.innerHTML = "";
  Birthrecords.forEach(record => {
    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${record.name}</td>
      <td>${record.type}</td>
      <td>${record.regNo}</td>
      <td>${record.dateRegistered}</td>
      <td>
        <div class="progress-bar-container">
          <div class="progress-bar" style="width: ${getProgressPercentage(record.status)}%; background-color: ${getStatusColor(record.status)};"></div>
          <span style="color: ${getStatusColor(record.status)};">${record.status}</span>
        </div>
      </td>
      <td class="actions">
        <span class="ellipsis" onclick="toggleMenu(this)"><i class="fas fa-ellipsis-v"></i></span>
        <div class="action-menu">
          <button onclick="editRow('BirthRecords', '${record.regNo}')"><i class="fas fa-edit mr-2"></i> Edit</button>
          <button onclick="deleteRecord('BirthRecords', '${record.regNo}')"><i class="fas fa-trash mr-2"></i> Delete</button>
        </div>
      </td>
    `;
    Birthtbody.appendChild(row);
  });

  // Repeat for Marriage and Death records
  Marriagetbody.innerHTML = "";
  Marriagerecords.forEach(record => {
    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${record.name}</td>
      <td>${record.type}</td>
      <td>${record.regNo}</td>
      <td>${record.dateRegistered}</td>
      <td>
        <div class="progress-bar-container">
          <div class="progress-bar" style="width: ${getProgressPercentage(record.status)}%; background-color: ${getStatusColor(record.status)};"></div>
          <span style="color: ${getStatusColor(record.status)};">${record.status}</span>
        </div>
      </td>
      <td class="actions">
        <span class="ellipsis" onclick="toggleMenu(this)"><i class="fas fa-ellipsis-v"></i></span>
        <div class="action-menu">
          <button onclick="editRow('MarriageRecords', '${record.regNo}')"><i class="fas fa-edit mr-2"></i> Edit</button>
          <button onclick="deleteRecord('MarriageRecords', '${record.regNo}')"><i class="fas fa-trash mr-2"></i> Delete</button>
        </div>
      </td>
    `;
    Marriagetbody.appendChild(row);
  });

  Deathtbody.innerHTML = "";
  Deathrecords.forEach(record => {
    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${record.name}</td>
      <td>${record.type}</td>
      <td>${record.regNo}</td>
      <td>${record.dateRegistered}</td>
      <td>
        <div class="progress-bar-container">
          <div class="progress-bar" style="width: ${getProgressPercentage(record.status)}%; background-color: ${getStatusColor(record.status)};"></div>
          <span style="color: ${getStatusColor(record.status)};">${record.status}</span>
        </div>
      </td>
      <td class="actions">
        <span class="ellipsis" onclick="toggleMenu(this)"><i class="fas fa-ellipsis-v"></i></span>
        <div class="action-menu">
          <button onclick="editRow('DeathRecords', '${record.regNo}')"><i class="fas fa-edit mr-2"></i> Edit</button>
          <button onclick="deleteRecord('DeathRecords', '${record.regNo}')"><i class="fas fa-trash mr-2"></i> Delete</button>
        </div>
      </td>
    `;
    Deathtbody.appendChild(row);
  });

  // Update the graph after loading records
  renderGraph();
}

// Helper function to get progress percentage based on status
function getProgressPercentage(status) {
  switch (status) {
    case "Received":
      return 25;
    case "Processing":
      return 50;
    case "For Signature":
      return 75;
    case "Ready for Release":
      return 100;
    default:
      return 0;
  }
}

// Helper function to get color based on status
function getStatusColor(status) {
  switch (status) {
    case "Received":
      return "red";
    case "Processing":
      return "orange";
    case "For Signature":
      return "yellow";
    case "Ready for Release":
      return "green";
    default:
      return "gray";
  }
}

// Helper function to capitalize the first letter of each word in the status
function capitalizeStatus(status) {
  return status
    .split(" ")
    .map(word => word.charAt(0).toUpperCase() + word.slice(1))
    .join(" ");
}

// Helper function to determine progress percentage based on status
function getProgressPercentage(status) {
  switch (status) {
    case "Received":
      return 25;
    case "Processing":
      return 50;
    case "For Signature":
      return 75;
    case "Ready for Release":
      return 100;
    default:
      return 0; // Default for unknown status
  }
}

function applySearch(tableId, searchInputId) {
  const searchText = document.getElementById(searchInputId).value.toLowerCase();
  const rows = document.querySelectorAll(`#${tableId} tbody tr`);

  rows.forEach(row => {
    const rowText = row.innerText.toLowerCase();
    row.style.display = rowText.includes(searchText) ? "" : "none";
  });
}


let barChartInstance; // Store the chart instance globally

function renderGraph() {
  const birthRecords = JSON.parse(localStorage.getItem("BirthRecords")) || [];
  const marriageRecords = JSON.parse(localStorage.getItem("MarriageRecords")) || [];
  const deathRecords = JSON.parse(localStorage.getItem("DeathRecords")) || [];

  const birthCount = birthRecords.length;
  const marriageCount = marriageRecords.length;
  const deathCount = deathRecords.length;

  const ctx = document.getElementById("recordsChart").getContext("2d");

  // Destroy the previous chart instance if it exists
  if (barChartInstance) {
    barChartInstance.destroy();
  }

  // Create a new chart instance
  barChartInstance = new Chart(ctx, {
    type: "bar",
    data: {
      labels: ["Birth Records", "Marriage Records", "Death Records"],
      datasets: [
        {
          label: "Number of Records",
          data: [birthCount, marriageCount, deathCount],
          backgroundColor: ["#4caf50", "#2196f3", "#f44336"],
          hoverBackgroundColor: ["#66bb6a", "#42a5f5", "#e57373"],
          borderColor: ["#388e3c", "#1976d2", "#d32f2f"],
          borderWidth: 1,
        },
      ],
    },
    options: {
      responsive: true,
      maintainAspectRatio: false, // Allow dynamic resizing
      plugins: {
        legend: {
          display: true,
          position: "top",
          labels: {
            font: {
              size: 14,
              family: "Arial",
            },
            color: "#333",
          },
        },
        tooltip: {
          enabled: true,
          backgroundColor: "#fff",
          borderColor: "#ccc",
          borderWidth: 1,
          titleColor: "#000",
          bodyColor: "#000",
          bodyFont: {
            size: 12,
          },
          titleFont: {
            size: 14,
            weight: "bold",
          },
        },
      },
      scales: {
        x: {
          grid: {
            display: false,
          },
          ticks: {
            font: {
              size: 12,
              family: "Arial",
            },
            color: "#333",
          },
        },
        y: {
          beginAtZero: true,
          max: 100,
          grid: {
            color: "#e0e0e0",
            lineWidth: 1,
          },
          ticks: {
            font: {
              size: 12,
              family: "Arial",
            },
            color: "#333",
          },
        },
      },
    },
  });
}

// Add a resize listener to redraw the chart when the window size changes
window.addEventListener("resize", () => {
  const graphContainer = document.querySelector(".graph-container");
  const canvas = document.getElementById("recordsChart");

  // Adjust canvas size dynamically
  canvas.width = graphContainer.offsetWidth;
  canvas.height = graphContainer.offsetHeight;

  // Re-render the chart
  renderGraph();
});


let donutChartInstance; // Store the chart instance globally

function renderDonutChart() {
  const birthRecords = JSON.parse(localStorage.getItem("BirthRecords")) || [];
  const marriageRecords = JSON.parse(localStorage.getItem("MarriageRecords")) || [];
  const deathRecords = JSON.parse(localStorage.getItem("DeathRecords")) || [];

  // Combine all records into one array
  const allRecords = [...birthRecords, ...marriageRecords, ...deathRecords];

  // Count occurrences of each request type dynamically
  const requestTypeCounts = allRecords.reduce((acc, record) => {
    acc[record.type] = (acc[record.type] || 0) + 1;
    return acc;
  }, {});

  // Extract labels (request types) and data (counts) for the pie chart
  const labels = Object.keys(requestTypeCounts); // Dynamic request types
  const data = Object.values(requestTypeCounts); // Counts for each type

  const ctx = document.getElementById("requestTypeChart").getContext("2d");

  // Destroy the previous chart instance if it exists
  if (donutChartInstance) {
    donutChartInstance.destroy();
  }

  // Create a new chart instance
  donutChartInstance = new Chart(ctx, {
    type: "doughnut", // Set chart type to doughnut
    data: {
      labels: labels, // Dynamic labels
      datasets: [
        {
          data: data, // Dynamic data
          backgroundColor: [
            "#4caf50", "#2196f3", "#f44336", "#ff9800", "#9c27b0", "#00bcd4",
            "#8bc34a", "#ffc107", "#e91e63", "#607d8b", "#795548", "#673ab7",
          ], // Colors for each type
          hoverBackgroundColor: [
            "#66bb6a", "#42a5f5", "#e57373", "#ffb74d", "#ba68c8", "#4dd0e1",
            "#aed581", "#ffd54f", "#f06292", "#90a4ae", "#a1887f", "#9575cd",
          ], // Hover colors for each type
          borderWidth: 1,
        },
      ],
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          display: true,
          position: "bottom", // Move legends to the bottom
          labels: {
            font: {
              size: 10, // Reduce font size for smaller legends
              family: "Arial",
            },
            color: "#333",
            boxWidth: 10, // Reduce box size for legend icons
          },
        },
        tooltip: {
          enabled: true,
          backgroundColor: "#fff",
          borderColor: "#ccc",
          borderWidth: 1,
          titleColor: "#000",
          bodyColor: "#000",
          bodyFont: {
            size: 12,
          },
          titleFont: {
            size: 14,
            weight: "bold",
          },
        },
      },
      cutout: "50%", // Creates the donut effect
    },
  });
}

window.addEventListener("resize", () => {
  const pieChartContainer = document.querySelector(".pie-chart");
  const canvas = document.getElementById("requestTypeChart");

  // Adjust canvas size dynamically
  canvas.width = pieChartContainer.offsetWidth;
  canvas.height = pieChartContainer.offsetHeight;

  // Re-render the chart
  renderDonutChart();
});

function renderRecentActivities() {
  const birthRecords = JSON.parse(localStorage.getItem("BirthRecords")) || [];
  const marriageRecords = JSON.parse(localStorage.getItem("MarriageRecords")) || [];
  const deathRecords = JSON.parse(localStorage.getItem("DeathRecords")) || [];

  const activityContainer = document.querySelector(".activity-container");

  // Clear existing activities
  activityContainer.innerHTML = `<h3>Recent Activities</h3>`;

  // Helper function to render records
  function renderRecords(records, type, colorClass) {
    const recentRecords = records.slice(-3).reverse(); // Get the last 5 records (most recent first)
    if (recentRecords.length > 0) {
      let recordDetails = recentRecords
        .map(record => `<p>${record.name} - ${record.dateRegistered}</p>`)
        .join(""); // Generate HTML for each record

      activityContainer.innerHTML += `
        <div class="activity">
          <div class="icon ${colorClass}"><i class="fa-solid fa-${type === "Birth" ? "plus" : type === "Marriage" ? "pen" : "trash"}"></i></div>
          <div class="info">
            <strong>${type} Records</strong>
            ${recordDetails}
          </div>
        </div>
      `;
    }
  }

  // Render the first five recent records for each category
  renderRecords(birthRecords, "Birth", "blue");
  renderRecords(marriageRecords, "Marriage", "yellow");
  renderRecords(deathRecords, "Death", "red");
}



// Call the renderRecentActivities function after loading the dashboard records
window.onload = function () {
  loadDashboardRecords();
  countRecords();
  renderGraph();
  renderDonutChart();
  renderRecentActivities(); // Render recent activities
  showSection("overview"); // Default section to show
};
  </script>
</body>
</html>
