<!DOCTYPE html>
<html>
<head>
  <title>Request for Death Certificate - Home Delivery</title>
  <link href="https://fonts.cdnfonts.com/css/golos-text" rel="stylesheet" />
  <link rel="icon" href="/images/cris_logo.png" type="image/x-icon">


  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Golos Text', sans-serif;
      background:
        url('death-bg-new.png') no-repeat bottom left fixed,
        url('d-bird-bg.png') no-repeat top right fixed;
      background-size: 500px auto, 300px auto;
      /* size for each image */
      background-color: #f8f7f2;
      min-height: 100vh;
      background-attachment: fixed;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .container {
      background: rgba(255, 255, 255, 0.95);
      padding: 40px;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.25);
      max-width: 600px;
      width: 100%;
    }

    h2 {
      text-align: center;
      margin-bottom: 25px;
      font-size: 1.8rem;
      color: #333;
    }

    label {
      font-weight: 500;
      margin-top: 15px;
      display: block;
      color: #555;
    }

    input[type="text"],
    input[type="date"],
    input[type="number"],
    input[type="email"],
    input[type="tel"],
    select {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid #ccc;
      border-radius: 8px;
      box-sizing: border-box;
      margin-top: 5px;
      font-size: 1rem;
      transition: border-color 0.3s;
    }

    input[type="text"]:focus,
    input[type="date"]:focus,
    input[type="number"]:focus,
    input[type="email"]:focus {
      border-color: #28a745;
      outline: none;
    }

    input[type="file"] {
      margin-top: 8px;
    }

    input[type="checkbox"] {
      margin-right: 8px;
    }

    input:focus::placeholder {
      color: transparent;
    }

    .address-section input {
      margin-top: 8px;
    }

    button {
      margin-top: 25px;
      width: 100%;
      padding: 12px;
      background-color: #2980b9;
      border: none;
      color: white;
      font-weight: bold;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    button:hover {
      background-color: #218838;
    }

    /* Confirmation Modal */
    #sms-confirmation {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 1000;
    }

    .modal-content {
      background: white;
      padding: 30px;
      border-radius: 12px;
      width: 90%;
      max-width: 400px;
      margin: 15% auto;
      text-align: center;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
    }

    .modal-content h3 {
      margin-bottom: 15px;
      color: #333;
    }

    .modal-content p {
      margin-bottom: 20px;
      color: #555;
    }

    .modal-content button {
      padding: 10px 20px;
      background-color: #28a745;
      border: none;
      color: white;
      border-radius: 6px;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    .modal-content button:hover {
      background-color: #218838;
    }

    .back-button {
      display: inline-block;
      margin: 20px 0 20px 10px;
      /* Push to left */
      text-align: center;
      padding: 10px 15px;
      background-color: #f70707;
      text-decoration: none;
      color: #e9e3e3;
      border-radius: 5px;
      font-weight: bold;
    }

    .back-button:hover {
      background-color: #f10707;
      transform: scale(1.05);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }

    .address-selector {
      margin-top: 10px;
    }

    .address-level {
      margin-bottom: 10px;
    }

    .address-level label,
    .address-final label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
    }

    .address-final {
      margin-top: 15px;
    }

    .address-final input {
      margin-top: 5px;
      width: 100%;
      padding: 8px;
      font-size: 1rem;
    }

    .disabled-select {
      background-color: #f5f5f5;
      color: #666;
      cursor: not-allowed;
      width: 100%;
      padding: 8px;
    }

    select,
    input[type="text"],
    input[type="number"] {
      width: 100%;
      padding: 8px;
      font-size: 1rem;
    }

    .error-message {
      color: #e74c3c;
      font-size: 0.85rem;
      margin-top: 5px;
      display: none;
    }
  </style>
</head>
<body>
<script> 
  const services = {
     title: "Death Services",
    offers: {
      death_delivery: {
        name: "Death Delivery Registration",
        baseFee: 150,
        description: "Registration of death delivery details",
        rushFee: 50
      }
    }
  };

  const currentService = {
    type: "death",
    offer: "death_certificate" 
  };
</script>

  <section>
    <div class="container">
      <a class="back-button" href="Death-service.html">Back</a>
      <h2>Request for Death Certificate<br> (Home Delivery)</h2>
      <div class="CertRequest">
        <form id="appointm" onsubmit="event.preventDefault(); showSMSConfirmation();">
          <label for="registry">Registry</label>
          <input type="text" id="regno" placeholder="Enter Registry Number" required>

          <label for="fullname">Fullname</label>
          <input type="text" id="fullName" placeholder="Last Name, First Name, Middle Name" required>

          <label for="date">Date of Birth</label>
          <input type="date" id="date" required>

          <label for="sex">Sex</label>
          <select name="sex" id="sex">
            <option value="">Select</option>
            <option value="male">Male</option>
            <option value="female">Female</option>
          </select>

          <label for="occupation">Occupation</label>
          <input type="text" id="occupation" placeholder="Occupation" required>

          <label for="relation">Relationship to the Deceased</label>
          <input type="text" id="relation" placeholder="ex. son, wife, father, etc." required>

          <label for="number">Number of Copies</label>
          <input type="number" id="copies" min="1" value="1" required>

          <h3 style="margin-top: 25px; color: #333;">Delivery Address</h3>
          <div class="address-selector">
            <div class="address-level">
              <label>Region</label>
              <select id="delivery-region" required class="disabled-select" disabled>
                <option value="NCR" selected>National Capital Region (NCR)</option>
              </select>
            </div>

            <div class="address-level">
              <label>City/Municipality</label>
              <select id="delivery-city" required class="disabled-select" disabled>
                <option value="MANILA" selected>City of Manila</option>
              </select>
            </div>

            <div class="address-level">
              <label>District</label>
              <select id="delivery-district" required>
                <option value="">Select District</option>
                <option value="District I">District I</option>
                <option value="District II">District II</option>
                <option value="District III">District III</option>
                <option value="District IV">District IV</option>
                <option value="District V">District V</option>
                <option value="District VI">District VI</option>
              </select>
              <div id="delivery-district-error" class="error-message">Please select a district</div>
            </div>

            <div class="address-level">
              <label>Barangay</label>
              <select id="delivery-barangay" required>
                <option value="">Select Barangay</option>
              </select>
              <div id="delivery-barangay-error" class="error-message">Please select a barangay</div>
            </div>

            <div class="address-final">
              <label>Street Address (House No., Street, Subdivision, etc.)</label>
              <input type="text" id="houseNo" placeholder="e.g. 123 Mabini St." required>
              <div id="delivery-street-error" class="error-message">Please enter your street address</div>
            </div>

            <div class="address-final">
              <label>ZIP Code</label>
              <input type="number" id="zip_code" placeholder="e.g. 1000" required maxlength="4">
              <div id="delivery-zip-error" class="error-message">Please enter a valid 4-digit ZIP code</div>
            </div>
          </div>

          <label for="contact">Contact No.</label>
          <input type="tel" id="contact" pattern="[0-9]{4}-[0-9]{3}-[0-9]{4}" placeholder="09XX-XXX-XXXX" required>
          <div id="contact-error" class="error-message">Please enter a valid contact number (09XX-XXX-XXXX)</div>

          <label for="email">Email Address</label>
          <input type="email" id="email" placeholder="your@email.com" required>
          <div id="email-error" class="error-message">Please enter a valid email address</div>

          <label for="Upload">Upload Both Valid ID of the Parents</label>
          <input type="file" id="idupload" accept="image/*,application/pdf">

          <label style="margin-top: 20px;">
            <input type="checkbox" required> I certify that the information provided is true and correct.
          </label>

          <button type="submit">Submit Request</button>
        </form>
      </div>
    </div>
  </section>

  <div id="sms-confirmation">
    <div class="modal-content">
      <h3>Request Submitted!</h3>
      <p>
        You will receive a confirmation message via SMS and Email once the certificate is ready for delivery.<br><br>
        <b>Death Certificate Fee: ₱150.00 per copy</b><br>
        <b>Delivery Fee: ₱50.00</b><br>
        <b>Total Amount Due: ₱<span id="totalAmount">200.00</span></b><br><br>
        <b>You will now be redirected to the Payment Transaction page.</b>
      </p>
      <button onclick="proceedToDeathCertificatePayment()">Proceed to Payment</button>
    </div>
  </div>

  <div class="gtranslate_wrapper"></div>
  <script>

    // Keep the translation script first
    window.gtranslateSettings = {
      "default_language": "en",
      "wrapper_selector": ".gtranslate_wrapper",
      "switcher_horizontal_position": "right",
      "switcher_vertical_position": "bottom",
      "flag_style": "3d"
    }

    // District to Barangay mapping for Manila
    const districtBarangays = {
      "District I": ["Binondo", "Quiapo", "San Nicolas", "Santa Cruz", "Tondo I", "Tondo II"],
      "District II": ["Ermita", "Intramuros", "Malate", "Paco", "Pandacan", "Port Area", "San Miguel", "San Andres"],
      "District III": ["Santa Ana", "Santa Mesa"],
      "District IV": ["Sampaloc East", "Sampaloc West", "San Isidro", "San Jose", "San Juan", "San Rafael", "Santa Mesa", "Santo Cristo", "Santo Domingo", "Talayan"],
      "District V": ["Pandacan", "San Andres Bukid", "Santa Ana"],
      "District VI": ["Paco", "San Andres Bukid", "Santa Ana"]
    };

    // Get dropdown elements
    const districtDropdown = document.getElementById('delivery-district');
    const barangayDropdown = document.getElementById('delivery-barangay');

    // Populate barangays based on district selection
    if (districtDropdown) {
      districtDropdown.addEventListener('change', function() {
        const selectedDistrict = this.value;
        barangayDropdown.innerHTML = '<option value="">Select Barangay</option>';
        
        if (selectedDistrict && districtBarangays[selectedDistrict]) {
          districtBarangays[selectedDistrict].forEach(barangay => {
            const option = document.createElement('option');
            option.value = barangay;
            option.textContent = barangay;
            barangayDropdown.appendChild(option);
          });
        }
      });
    }

    function generateRegistryNumber() {
      const now = new Date();
      return `REG-${now.getFullYear()}${(now.getMonth() + 1)
        .toString()
        .padStart(2, "0")}${now.getDate().toString().padStart(2, "0")}-${now
        .getTime()
        .toString()
        .slice(-5)}`;
    }

    function sendToDashboard() {
      const fullName = document.getElementById("fullName").value;
      const requestType = "Request for Death Certificate (Home Delivery)";
      const registryNumber = generateRegistryNumber();
      const dateRegistered = new Date().toLocaleDateString();

      const record = {
        name: fullName,
        type: requestType,
        regNo: registryNumber,
        dateRegistered: dateRegistered,
      };

      // Save to localStorage (or send via API)
      const records = JSON.parse(localStorage.getItem("DeathRecords")) || [];
      records.push(record);
      localStorage.setItem("DeathRecords", JSON.stringify(records));
    }

    function showSMSConfirmation() {
      // Validate form first
      if (!validateForm()) {
        return;
      }
      
      // Calculate total amount
      const copies = parseInt(document.getElementById("copies").value) || 1;
      const baseFee = services.death.offers.death_certificate.baseFee;
      const deliveryFee = services.death.offers.death_certificate.deliveryFee;
      const totalAmount = (baseFee * copies) + deliveryFee;
      
      // Update the total amount in the modal
      document.getElementById("totalAmount").textContent = totalAmount.toFixed(2);
      
      sendToDashboard();
      // Show the confirmation modal
      document.getElementById('sms-confirmation').style.display = 'block';
      // Reset the form fields
      document.getElementById('appointm').reset();
    }

    function proceedToDeathCertificatePayment() {
      document.getElementById('sms-confirmation').style.display = 'none';
      // Redirect to payment page instead of showing feedback
      window.location.href = "../payment.html?service=death&offer=death_certificate";
    }

    function validateForm() {
      let isValid = true;
      
      // Validate contact number
      const contactPattern = /^09\d{2}-\d{3}-\d{4}$/;
      const contactInput = document.getElementById('contact');
      const contactError = document.getElementById('contact-error');
      
      if (!contactPattern.test(contactInput.value)) {
        contactError.style.display = 'block';
        isValid = false;
      } else {
        contactError.style.display = 'none';
      }
      
      // Validate email
      const emailInput = document.getElementById('email');
      const emailError = document.getElementById('email-error');
      
      if (!emailInput.validity.valid) {
        emailError.style.display = 'block';
        isValid = false;
      } else {
        emailError.style.display = 'none';
      }
      
      // Validate district
      if (!districtDropdown.value) {
        document.getElementById('delivery-district-error').style.display = 'block';
        isValid = false;
      } else {
        document.getElementById('delivery-district-error').style.display = 'none';
      }
      
      // Validate barangay
      if (!barangayDropdown.value) {
        document.getElementById('delivery-barangay-error').style.display = 'block';
        isValid = false;
      } else {
        document.getElementById('delivery-barangay-error').style.display = 'none';
      }
      
      return isValid;
    }

    // Date validation
    const deceasedDateInput = document.getElementById("date");
    if (deceasedDateInput) {
      const today = new Date();
      const maxDate = today.toISOString().split("T")[0];
      deceasedDateInput.setAttribute("max", maxDate);
    }

    // Phone number formatting
    const phoneInput = document.getElementById("contact");
    if (phoneInput) {
      phoneInput.addEventListener("input", function() {
        let value = this.value.replace(/\D/g, "");
        if (value.length > 4) value = value.slice(0, 4) + "-" + value.slice(4);
        if (value.length > 8) value = value.slice(0, 8) + "-" + value.slice(8, 12);
        this.value = value;
      });
    }
  </script>
  <script src="https://cdn.gtranslate.net/widgets/latest/float.js" defer></script>
  <script src="/payment.js"></script>
</body>
</html>